command hinttaball js if(void 0!==tri.tabsiframe)tri.tabsiframe.showAndHint();else{tri.tabsiframe={};let t=tri.tabsiframe;function e(t,e="",i="",a=""){let n=document.createElement(t);return""!=e&&(n.className=e),""!==i&&(n.id=i),n.textContent=a,n}function i(){let t=document.createDocumentFragment(),i=e("div","","ctrls");return i.replaceChildren(e("div","TridactylTabHint ctrl","prev","<--"),e("div","TridactylTabHint ctrl","next","-->"),e("div","TridactylTabHint ctrl","close","X"),e("div","TridactylTabHint ctrl","newtab","+"),e("div","TridactylTabHint ctrl","search","search")),t.appendChild(i),t}function a(){t.styleloaded=!0,t.maxcells(t.tabslist.length),!0===t.iframeloaded&&(t.observer.observe(t.observerTarget,{attributes:!0,subtree:!0}),t.sendtabs()),t.makehints().then(()=>{t.hint()})}function n(){t.iframeloaded=!0,t.sendStyle(t.customStyle),!0===t.styleloaded&&(t.observer.observe(t.observerTarget,{attributes:!0,subtree:!0}),t.sendtabs())}async function s(e=!0){t.tabslist=await tri.browserBg.tabs.query(e?{}:{currentWindow:!0});let s=document.createDocumentFragment();t.shadowHost=document.createElement("div"),t.shadowHost.id="TridactylTabsHintIframe";let l=t.shadowHost.attachShadow({mode:"open"}),d=document.createElement("link");l.appendChild(d),d.rel="stylesheet",d.type="text/css",d.href="https://chic-tweetz.github.io/TridactylHintTabs/hinttabs.css",d.onload=a;let c=document.createElement("div");c.id="dimmer",c.style["z-index"]=2147483645,l.appendChild(c);let o=document.createElement("div");o.className="outermost iframe",o.style.zIndex=2147483646;let h=document.createElement("div");h.className="gridalign",t.iframe=document.createElement("iframe"),t.iframe.id="tabsiframe",t.iframe.src="https://chic-tweetz.github.io/TridactylHintTabs",t.iframe.onload=n,o.appendChild(h),h.appendChild(t.iframe);let b=document.createElement("div");b.className="outermost hints",b.style.zIndex=2147483645;let m=document.createElement("div");m.id="shadow",m.className="gridalign",t.hintgrid=document.createElement("div"),t.hintgrid.id="tabs",b.appendChild(m),m.appendChild(t.hintgrid),m.appendChild(i()),l.appendChild(o),l.appendChild(b),s.appendChild(t.shadowHost),document.documentElement.appendChild(s),t.observerTarget=m,t.observer=new MutationObserver(r)}function r(){let e=tri.tabsiframe.hintgrid.querySelector(".TridactylHintActive");if(e){t.msg(["highlight",e.index]);return}tri.tabsiframe.msg(["highlight",-1])}t.customStyle="",t.msg=function(t){tri.tabsiframe.iframe.contentWindow.postMessage(t,"https://chic-tweetz.github.io")},t.sendStyle=function(e){t.msg(["style",e])},t.firsttab=0,s(),t.maxcells=function(e){let i=getComputedStyle(t.hintgrid),a,n=Math.max(1,Math.floor((innerHeight-t.hintgrid.getBoundingClientRect().top)/parseFloat(i.backgroundSize))),s=i.gridTemplateColumns.split(" ").length;t.maxVisibleCells=s*n;let r=Math.min(e,s*n);return t.iframe.style.height="calc("+Math.ceil(r/s)+"*var(--tri-tabs-tab-spacing) - var(--tri-tabs-grid-gap))",t.hintcount=r,r},t.makehints=async function(){let e=document.createDocumentFragment();for(let i=0;i<t.hintcount;++i){let a=document.createElement("div");a.className="tab TridactylTabHint",a.tabid=t.tabslist[i+t.firsttab].id,a.index=i,e.appendChild(a)}t.hintgrid.replaceChildren(...e.children)},t.sendtabs=function(){t.msg(["newtabs",t.tabslist,t.hintcount])},t.refreshTabList=async function(e){t.tabslist=await tri.browserBg.tabs.query(e?{}:{currentWindow:!0}),t.firsttab=0,t.hintcount=t.maxcells(t.tabslist.length),t.sendtabs(),t.makehints()},t.gototab=async function(t){let e=await tri.browserBg.tabs.update(t,{active:!0});return await tri.browserBg.windows.update(e.windowId,{focused:!0}),e},t.updatehints=function(){for(let e=0;e<t.hintcount;++e)t.hintgrid.children[e].tabid=t.tabslist[e+t.firsttab].id,t.hintgrid.children[e].index=e;for(let i=t.hintcount;i<t.hintgrid.childElementCount;++i)t.hintgrid.children[i].tabid="fake",t.hintgrid.children[i].index=i},t.nextTabs=function(){let e=t.firsttab+t.hintgrid.childElementCount;e<t.tabslist.length&&(t.firsttab=e,t.hintcount=Math.min(t.tabslist.length-e,t.hintgrid.childElementCount),t.updatehints(),t.msg(["range",e,t.hintcount])),t.hint()},t.prevTabs=function(){let e=t.firsttab-t.maxVisibleCells;e>=0&&(t.firsttab=e,t.hintcount=Math.min(t.tabslist.length-e,t.maxVisibleCells),t.updatehints(),t.msg(["range",e,t.hintcount])),t.hint()},t.showAndHint=async function(e=!0){t.observer.observe(t.observerTarget,{attributes:!0,subtree:!0}),t.shadowHost.style.visibility="visible",await t.refreshTabList(e),t.makehints().then(e=>{t.hint()})},t.hide=function(){t.shadowHost.style.visibility="hidden",t.observer.disconnect()},t.hint=function(){tri.excmds.hint("-c",".TridactylTabHint").then(function(e){if(""===e)t.hide();else if(void 0!==e.tabid)"fake"===e.tabid?t.hint():(t.gototab(e.tabid),t.hide());else switch(e.id){case"prev":t.prevTabs();break;case"next":t.nextTabs();break;case"close":tri.excmds.tabclose();break;case"newtab":tri.excmds.tabopen(),t.hide();break;case"search":tri.excmds.fillcmdline("taball"),t.hide();break;default:t.hide()}})}}
